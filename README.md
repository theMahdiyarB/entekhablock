# 🗳️ انتخابِلاک (ENTEKHABLOCK)

<div dir="rtl">

سیستم رأی‌گیری الکترونیکی مبتنی بر بلاکچین با Flask و Material 3 Expressive UI

</div>

---

## 📋 فهرست مطالب

- [درباره پروژه](#-درباره-پروژه)
- [ویژگی‌های کلیدی](#-ویژگی-های-کلیدی)
- [معماری سیستم](#-معماری-سیستم)
- [مستندات فنی](#-مستندات-فنی)
- [پیش‌نیازها](#-پیش-نیازها)
- [نصب و راه‌اندازی](#-نصب-و-راه-اندازی)
- [راهنمای استفاده](#-راهنمای-استفاده)
- [ساختار پروژه](#-ساختار-پروژه)
- [API و Endpoints](#-api-و-endpoints)
- [امنیت](#-امنیت)
- [مشارکت در پروژه](#-مشارکت-در-پروژه)

---

## 🎯 درباره پروژه

**انتخابِلاک** یک سیستم رأی‌گیری الکترونیکی امن است که از تکنولوژی بلاکچین برای تضمین شفافیت و جلوگیری از تقلب استفاده می‌کند. این پروژه با تمرکز بر **تجربه کاربری حرفه‌ای** و **امنیت چندلایه‌ای** طراحی شده است.

### مشخصات فنی:
- **زبان برنامه‌نویسی:** Python 3.10+
- **فریمورک:** Flask 3.0.0
- **امنیت:** Flask-Limiter (Rate Limiting) + Flask-WTF (CSRF Protection)
- **ذخیره‌سازی داده:**
  - رأی‌دهندگان: CSV (`voters.csv`)
  - نظرسنجی‌ها: JSON (`data/polls.json`)
  - بلاکچین: JSON (`data/blockchain.json`) - شامل قابلیت ماندگاری (Persistence)
- **احراز هویت:** سیستم 3 مرحله‌ای (اطلاعات پایه + OTP + بیومتریک)
- **مدیریت تاریخ:** `jdatetime` و `persian-datepicker` برای تقویم شمسی
- **مدیریت نشست:** Flask Session با کلید مخفی پایدار
- **رمزنگاری:** SHA-256 salted برای هش هویت‌ها و هش بلاک‌ها
- **رابط کاربری:** Material 3 Expressive Design System
- **بصری‌سازی:** Chart.js 4.4.1 (نمودارهای میله‌ای و دایره‌ای تعاملی)

### اهداف پروژه:
✅ شفافیت کامل در فرآیند رأی‌گیری  
✅ جلوگیری از تقلب و دستکاری آرا  
✅ حفظ محرمانگی رأی‌دهندگان  
✅ امکان ممیزی و بررسی نتایج  
✅ رابط کاربری مدرن و فارسی با Material 3

---

## ⚡ ویژگی‌های کلیدی

### 🔐 احراز هویت 3 مرحله‌ای
- **مرحله 1:** تأیید اطلاعات پایه (کد ملی، تاریخ تولد، شماره شناسنامه)
- **مرحله 2:** تأیید کد یکبار مصرف (OTP) ارسال شده به موبایل
- **مرحله 3:** احراز هویت بیومتریک (ضبط ویدئو چهره)
- مدیریت نشست امن با Flask Session
- کلید مخفی پایدار برای جلوگیری از invalidation نشست‌ها

### ⛓️ بلاکچین (Blockchain)
- پیاده‌سازی زنجیره بلوکی شفاف و قابل ممیزی سفارشی
- هشینگ SHA-256 برای تضمین عدم تغییر آرا
- مکانیزم Proof of Work برای امنیت شبکه
- الگوریتم Proof of Work قابل تنظیم
- ذخیره‌سازی تراکنش‌های رأی در بلاک‌ها
- Genesis Block خودکار
- ممیزی و تأیید صحت زنجیره
- نمایش کامل اطلاعات هر بلاک

### 🎨 رابط کاربری Material 3 Expressive
- طراحی مدرن و جذاب با Material 3
- استفاده از رنگ‌های solid (بدون gradient)
- Border-radius یکپارچه (12px برای اکثر المان‌ها)
- Elevation و shadow سیستم M3
- پشتیبانی کامل از فارسی و RTL
- Responsive برای تمام دستگاه‌ها
- فونت Vazirmatn

### 📊 مدیریت نظرسنجی
- ایجاد نظرسنجی توسط ادمین
- تعیین تاریخ شروع و پایان
- گزینه‌های متعدد برای هر نظرسنجی
- نمایش نتایج real-time
- محدودیت یک رأی برای هر کاربر

### 🛡️ پنل ادمین
- احراز هویت جداگانه برای ادمین
- ساختار مدرن با Navigation Rail سراسری
- ایجاد و مدیریت نظرسنجی‌ها با تقویم شمسی
- مشاهده آمار کامل
- دسترسی به بلاکچین
- مدیریت رأی‌دهندگان

### 📄 مستندات فنی جامع
- صفحه اختصاصی **Deep Dive** با بیش از ۱۰۰۰ خط مستندات شامل:
  - دیاگرام‌های معماری ۴ لایه
  - مدل‌های داده (JSON)
  - جزئیات الگوریتم‌های رمزنگاری
  - ساختار درختی پروژه

---

## 🏗️ معماری سیستم

```
┌─────────────────────────────────────────────────────────┐
│     Frontend (Material 3 Expressive UI & Motion)        │
│    Templates + Nav Rail + Bottom Nav + Motion Engine    │
└────────────────────┬────────────────────────────────────┘
                     │
┌────────────────────▼────────────────────────────────────┐
│                Flask Application (app.py)               │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐   │
│  │   Routes     │  │   Managers   │  │   Utils      │   │
│  │  (Endpoints) │  │  (Business)  │  │  (Helpers)   │   │
│  └──────────────┘  └──────────────┘  └──────────────┘   │
└────────────────────┬────────────────────────────────────┘
                     │
┌────────────────────▼────────────────────────────────────┐
│              Data Storage Layer                         │
│  ┌──────────────┐  ┌──────────────┐  ┌───────────────┐  │
│  │ voters.csv   │  │  polls.json  │  │blockchain.json│  │
│  │ (Voter Data) │  │ (Poll Data)  │  │ (Blockchain)  │  │
│  └──────────────┘  └──────────────┘  └───────────────┘  │
└─────────────────────────────────────────────────────────┘

Core Managers:
├── SessionManager: مدیریت نشست‌های کاربران و مراحل احراز هویت
├── OTPManager: تولید و تأیید کدهای یکبار مصرف
├── VoterDatabase: خواندن و نوشتن اطلاعات رأی‌دهندگان
├── PollManager: مدیریت نظرسنجی‌ها و رأی‌ها
└── Blockchain: مدیریت بلاکچین و تراکنش‌ها
```

---

## 📚 مستندات فنی

برای درگیری عمیق‌تر با جزئیات پیاده‌سازی، می‌توانید به صفحه `/technical` در اپلیکیشن مراجعه کنید. این بخش شامل:
- **معماری لایه‌بندی شده**
- **جزئیات چرخه حیات رأی**
- **فنی‌ترین بخش‌های بلاکچین**

---

## 🔧 پیش‌نیازها

### نرم‌افزارها:
- **Python:** نسخه 3.8 یا بالاتر
- **pip:** مدیریت پکیج‌های Python
- **Git:** (اختیاری) برای Clone کردن پروژه

### دانش فنی (توصیه می‌شود):
- آشنایی با Flask
- مفاهیم پایه بلاکچین
- Material Design 3

---

## 🚀 نصب و راه‌اندازی

### ۱. دانلود پروژه

```bash
# Clone کردن از Git
git clone https://github.com/theMahdiyarB/ENTEKHABLOCK.git
cd ENTEKHABLOCK

# یا دانلود فایل ZIP و استخراج
```

### ۲. ایجاد محیط مجازی

```bash
# ایجاد محیط مجازی
python -m venv venv

# فعال‌سازی محیط مجازی
# در Windows:
venv\Scripts\activate

# در macOS/Linux:
source venv/bin/activate
```

### ۳. نصب وابستگی‌ها

```bash
# نصب پکیج‌های مورد نیاز
pip install -r requirements.txt
```

### ۴. تنظیم متغیر محیطی (اختیاری)

```bash
# تنظیم کلید مخفی Flask (توصیه می‌شود)
# در Windows PowerShell:
$env:FLASK_SECRET_KEY="your-super-secret-key-here"

# در Linux/macOS:
export FLASK_SECRET_KEY="your-super-secret-key-here"
```

**نکته:** اگر کلید مخفی تنظیم نشود، برنامه از یک کلید پیش‌فرض استفاده می‌کند.

### ۵. اجرای برنامه

```bash
# اجرای برنامه
python3 app.py
```

**برنامه در آدرس زیر اجرا می‌شود:**
```
http://127.0.0.1:5000
```

---

## 📖 راهنمای استفاده

### ورود به سیستم (رأی‌دهنده)

#### مرحله 1: اطلاعات پایه
1. به آدرس `/login` بروید
2. اطلاعات تست را وارد کنید:
   - **کد ملی:** `0012345678`
   - **تاریخ تولد:** `1370-05-15`
   - **شماره شناسنامه:** `123-456789-1`
3. روی "ادامه" کلیک کنید

#### مرحله 2: تأیید OTP
1. کد OTP ارسال شده را وارد کنید
2. کد تست: `1234`
3. روی "تایید و ادامه" کلیک کنید

#### مرحله 3: احراز هویت بیومتریک
1. دسترسی به دوربین را مجاز کنید
2. روی "شروع ضبط ویدئو" کلیک کنید
3. پس از چند ثانیه روی "پایان ضبط" کلیک کنید
4. روی "تأیید و ورود به سیستم" کلیک کنید

### ورود به پنل ادمین

1. به آدرس `/admin/login` بروید
2. اطلاعات ادمین را وارد کنید:
   - **کد ملی:** `0000000000`
   - **تاریخ تولد:** `1360-01-01`
   - **شماره شناسنامه:** `000-000000-0`
3. مراحل OTP و بیومتریک را طی کنید (کد OTP: `1234`)

### ایجاد نظرسنجی (ادمین)

1. وارد پنل ادمین شوید
2. روی "ایجاد نظرسنجی جدید" کلیک کنید
3. اطلاعات نظرسنجی را وارد کنید:
   - عنوان
   - توضیحات
   - تاریخ شروع و پایان
   - گزینه‌های نظرسنجی
4. روی "ایجاد نظرسنجی" کلیک کنید

### رأی‌دهی

1. پس از ورود، نظرسنجی‌های فعال را مشاهده کنید
2. روی "مشاهده جزئیات" کلیک کنید
3. گزینه مورد نظر را انتخاب کنید
4. روی "ثبت رأی" کلیک کنید
5. رأی شما در بلاکچین ثبت می‌شود

### مشاهده بلاکچین

1. به آدرس `/view_blockchain` بروید
2. تمام بلاک‌ها را مشاهده کنید
3. برای مشاهده جزئیات هر بلاک، روی آن کلیک کنید
4. اطلاعات کامل شامل:
   - شماره بلاک
   - Hash بلاک
   - Previous Hash
   - Timestamp
   - Nonce
   - داده‌های تراکنش

---

## 📁 ساختار پروژه

```
ENTEKHABLOCK-MVP/
│
├── 📄 app.py                  # هسته اصلی برنامه
├── 📄 requirements.txt        # وابستگی‌های Python
├── 📄 .gitignore              # فایل‌های نادیده شده Git
├── 📄 README.md               # این فایل
│
├── 📁 templates/              # قالب‌های HTML
│   ├── base.html              # ساختار اصلی (Nav Rail/Bottom Nav)
│   ├── index.html             # صفحه اصلی
│   ├── login.html             # ورود (مرحله 1)
│   ├── otp.html               # تأیید OTP (مرحله 2)
│   ├── biometric.html         # بیومتریک (مرحله 3)
│   ├── dashboard.html         # داشبورد رأی‌دهنده
│   ├── vote.html              # صفحه رأی‌گیری
│   ├── results.html           # نتایج
│   ├── blockchain.html        # نمایش بلاکچین
│   ├── technical.html         # مستندات فنی عمیق (Whitepaper)
│   └── admin/                 # قالب‌های پنل ادمین
│       ├── login.html
│       ├── dashboard.html
│       ├── create_poll.html
│       └── otp.html
│
├── 📁 static/                # فایل‌های استاتیک
│   ├── css/                  # فایل‌های CSS
│   │   ├── style.css         # تم اصلی M3
│   │   ├── auth.css          # صفحات احراز هویت
│   │   ├── dashboard.css     # داشبورد
│   │   ├── blockchain.css    # صفحه بلاکچین
│   │   ├── vote.css          # صفحه رأی‌گیری
│   │   ├── results.css       # صفحه نتایج
│   │   ├── admin.css         # پنل ادمین
│   │   ├── 404.css           # صفحه خطا
│   │   ├── nav-rail.css      # استایل ناوبری جدید
│   │   └── motion.css        # سیستم انیمیشن M3
│   └── js/                   # اسکریپت‌های JavaScript
│       ├── auth.js
│       ├── biometric.js
│       ├── dashboard.js
│       ├── admin.js
│       ├── datepicker-setup.js # تنظیمات تقویم شمسی
│       └── results.js        # مدیریت نمودارها
│
├── 📁 data/                  # فایل‌های داده
│   ├── voters.csv            # اطلاعات رأی‌دهندگان
│   ├── polls.json            # نظرسنجی‌ها
│   └── blockchain.json       # بلاکچین
│
├── 📁 utils/                 # ابزارهای کمکی
│   ├── auth.py               # مدیریت احراز هویت و نشست‌ها
│   └── poll_manager.py       # مدیریت نظرسنجی‌ها
│
└── 📁 logs/                  # فایل‌های لاگ (اختیاری)
```

---

## 🔌 API و Endpoints

### مسیرهای عمومی (Public)

| مسیر | متد | توضیحات |
|------|------|---------|
| `/` | GET | صفحه اصلی |
| `/login` | GET, POST | ورود - مرحله 1 (اطلاعات پایه) |
| `/verify_otp` | GET, POST | ورود - مرحله 2 (تأیید OTP) |
| `/biometric` | GET, POST | ورود - مرحله 3 (بیومتریک) |
| `/logout` | GET | خروج از سیستم |
| `/view_blockchain` | GET | نمایش بلاکچین |
| `/technical` | GET | مستندات فنی عمیق |

### مسیرهای رأی‌دهنده (Voter)

| مسیر | متد | توضیحات | نیاز به ورود |
|------|------|---------|--------------|
| `/dashboard` | GET | داشبورد رأی‌دهنده | ✅ |
| `/vote/<poll_id>` | GET, POST | صفحه رأی‌دهی | ✅ |
| `/results/<poll_id>` | GET | نتایج نظرسنجی | ✅ |

### مسیرهای ادمین (Admin)

| مسیر | متد | توضیحات | نیاز به ادمین |
|------|------|---------|---------------|
| `/admin/login` | GET, POST | ورود ادمین | - |
| `/admin/dashboard` | GET | داشبورد ادمین | ✅ |
| `/admin/create_poll` | GET, POST | ایجاد نظرسنجی | ✅ |
| `/admin/polls` | GET | لیست نظرسنجی‌ها | ✅ |
| `/admin/delete_poll/<poll_id>` | POST | حذف نظرسنجی | ✅ |

### API Endpoints (JSON)

| مسیر | متد | توضیحات |
|------|------|---------|
| `/api/voter/auth/stage2/verify-otp` | POST | تأیید OTP (API) |
| `/api/polls/active` | GET | دریافت نظرسنجی‌های فعال |
| `/api/blockchain/validate` | GET | تأیید صحت بلاکچین |
| `/api/blockchain/tamper/<index>` | POST | دستکاری بلاک (فقط برای دمو) |

---

## 🔒 امنیت

### اقدامات امنیتی پیاده‌سازی شده:

✅ **احراز هویت 3 مرحله‌ای:** اطلاعات پایه + OTP + بیومتریک  
✅ **مدیریت نشست امن:** کلید مخفی پایدار و session-based auth  
✅ **محافظت CSRF:** استفاده از Flask-WTF برای تمام فرم‌ها
✅ **محدودیت نرخ (Rate Limiting):** جلوگیری از حملات Brute Force با Flask-Limiter
✅ **جلوگیری از رأی مکرر:** بررسی در سطح session و blockchain  
✅ **تأیید صحت بلاکچین:** الگوریتم Proof of Work  
✅ **هش SHA-256:** برای بلاک‌ها و تراکنش‌ها  
✅ **جداسازی دسترسی:** Admin/Voter roles

### توصیه‌های امنیتی:

⚠️ **کلید مخفی قوی تعریف کنید** (`FLASK_SECRET_KEY`)  
⚠️ **HTTPS در Production فعال کنید**  
⚠️ **از دیتابیس واقعی استفاده کنید** (PostgreSQL/MySQL)  
⚠️ **سیستم OTP واقعی پیاده‌سازی کنید** (SMS Gateway)  
⚠️ **احراز هویت بیومتریک واقعی** (Face Recognition API)

---

## 🤝 مشارکت در پروژه

از مشارکت شما در بهبود این پروژه استقبال می‌شود!

### مراحل مشارکت:

1. **Fork** کردن پروژه
2. ایجاد **Branch** جدید (`git checkout -b feature/amazing-feature`)
3. **Commit** تغییرات (`git commit -m 'Add amazing feature'`)
4. **Push** به Branch (`git push origin feature/amazing-feature`)
5. ایجاد **Pull Request**

### راهنمای کدنویسی:

- از PEP 8 برای Python پیروی کنید
- کامنت‌های فارسی برای توضیحات
- Material 3 Expressive guidelines را رعایت کنید
- مستندسازی کامل

---


## 📜 مجوز

این پروژه تحت مجوز **MIT** منتشر شده است.

---

## 🙏 تشکر و قدردانی

- **Flask:** فریمورک عالی Python
- **Material Design 3:** سیستم طراحی مدرن Google
- **Vazirmatn:** فونت فارسی زیبا
- جامعه توسعه‌دهندگان ایرانی

---

<div align="center">

**ساخته شده با ❤️ توسط تیم انتخابِلاک**

**نسخه 1.0.0** | **1404/11/11 (2026/01/30)**

[⭐ ستاره دهید](https://github.com/theMahdiyarB/ENTEKHABLOCK) | [🐛 گزارش باگ](https://github.com/theMahdiyarB/ENTEKHABLOCK/issues)

</div>

{% extends "base.html" %}

{% block title %}ایجاد نظرسنجی جدید - مدیریت{% endblock %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/admin.css') }}">
{% endblock %}

{% block content %}
<div class="admin-layout">
    <!-- Main Content -->
    <div class="admin-main fade-in-up">
        <header class="admin-header">
            <div>
                <a href="{{ url_for('admin_dashboard') }}"
                    style="text-decoration: none; color: var(--m3-primary); font-size: 14px; display: inline-block; margin-bottom: 16px;">←
                    بازگشت به داشبورد</a>
                <h1>ایجاد نظرسنجی جدید</h1>
                <p>تنظیمات و گزینه‌های نظرسنجی را در این بخش وارد کنید</p>
            </div>
        </header>

        <form action="{{ url_for('admin_create_poll') }}" method="POST" class="admin-card"
            style="margin: 0; max-width: 100%;">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <section class="form-section">
                <h3 class="title-large" style="margin-bottom: 24px;">اطلاعات پایه</h3>
                <div class="form-group">
                    <label class="form-label" for="title">عنوان نظرسنجی</label>
                    <input type="text" id="title" name="title" class="form-input" required
                        placeholder="مثال: انتخابات شورای صنفی ۱۴۰۳">
                </div>
                <div class="form-group">
                    <label class="form-label" for="description">توضیحات</label>
                    <textarea id="description" name="description" class="form-textarea" rows="4"
                        placeholder="جزئیات نظرسنجی را در اینجا بنویسید..."></textarea>
                </div>
            </section>

            <section class="form-section" style="margin-top: 48px;">
                <h3 class="title-large" style="margin-bottom: 24px;">زمان‌بندی (شمسی)</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px;">
                    <div class="form-group">
                        <label class="form-label">تاریخ شروع</label>
                        <div style="display: flex; gap: 8px;">
                            <select name="start_day" class="form-select" required style="width: 33%;">
                                <option value="" disabled selected>روز</option>
                                {% for d in range(1, 32) %}
                                <option value="{{ d }}">{{ d }}</option>
                                {% endfor %}
                            </select>
                            <select name="start_month" class="form-select" required style="width: 33%;">
                                <option value="" disabled selected>ماه</option>
                                <option value="1">فروردین</option>
                                <option value="2">اردیبهشت</option>
                                <option value="3">خرداد</option>
                                <option value="4">تیر</option>
                                <option value="5">مرداد</option>
                                <option value="6">شهریور</option>
                                <option value="7">مهر</option>
                                <option value="8">آبان</option>
                                <option value="9">آذر</option>
                                <option value="10">دی</option>
                                <option value="11">بهمن</option>
                                <option value="12">اسفند</option>
                            </select>
                            <select name="start_year" class="form-select" required style="width: 33%;">
                                <option value="" disabled selected>سال</option>
                                {% for y in range(1402, 1412) %}
                                <option value="{{ y }}" {% if y == 1403 %}selected{% endif %}>{{ y }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">تاریخ پایان</label>
                        <div style="display: flex; gap: 8px;">
                            <select name="end_day" class="form-select" required style="width: 33%;">
                                <option value="" disabled selected>روز</option>
                                {% for d in range(1, 32) %}
                                <option value="{{ d }}">{{ d }}</option>
                                {% endfor %}
                            </select>
                            <select name="end_month" class="form-select" required style="width: 33%;">
                                <option value="" disabled selected>ماه</option>
                                <option value="1">فروردین</option>
                                <option value="2">اردیبهشت</option>
                                <option value="3">خرداد</option>
                                <option value="4">تیر</option>
                                <option value="5">مرداد</option>
                                <option value="6">شهریور</option>
                                <option value="7">مهر</option>
                                <option value="8">آبان</option>
                                <option value="9">آذر</option>
                                <option value="10">دی</option>
                                <option value="11">بهمن</option>
                                <option value="12">اسفند</option>
                            </select>
                            <select name="end_year" class="form-select" required style="width: 33%;">
                                <option value="" disabled selected>سال</option>
                                {% for y in range(1402, 1412) %}
                                <option value="{{ y }}" {% if y == 1403 %}selected{% endif %}>{{ y }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                </div>
            </section>

            <section class="form-section" style="margin-top: 48px;">
                <h3 class="title-large" style="margin-bottom: 24px;">گزینه‌های رأی‌گیری</h3>
                <div id="options-container">
                    <div class="form-group" style="display: flex; gap: 12px; margin-bottom: 12px;">
                        <input type="text" name="options[]" class="form-input" required placeholder="گزینه ۱">
                    </div>
                    <div class="form-group" style="display: flex; gap: 12px; margin-bottom: 12px;">
                        <input type="text" name="options[]" class="form-input" required placeholder="گزینه ۲">
                    </div>
                </div>
                <button type="button" class="btn btn-outlined" id="add-option" style="margin-top: 8px;">
                    ➕ افزودن گزینه دیگر
                </button>
            </section>

            <section class="form-section"
                style="margin-top: 48px; padding-top: 32px; border-top: 1px solid var(--m3-outline-variant); display: flex; justify-content: flex-end; gap: 16px;">
                <a href="{{ url_for('admin_dashboard') }}" class="btn btn-text">انصراف</a>
                <button type="submit" class="btn btn-filled">ایجاد و انتشار نظرسنجی</button>
            </section>
        </form>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.getElementById('add-option').addEventListener('click', function () {
        const container = document.getElementById('options-container');
        const count = container.children.length + 1;
        const div = document.createElement('div');
        div.className = 'form-group';
        div.style.display = 'flex';
        div.style.gap = '12px';
        div.style.marginBottom = '12px';
        div.innerHTML = `<input type="text" name="options[]" class="form-input" required placeholder="گزینه ${count}">`;
        container.appendChild(div);
    });
</script>
{% endblock %}
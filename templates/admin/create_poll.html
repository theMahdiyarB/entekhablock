{% extends "base.html" %}

{% block title %}ایجاد نظرسنجی جدید - مدیریت{% endblock %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/admin.css') }}">
{% endblock %}

{% block content %}
<div class="admin-layout">
    <!-- Main Content -->
    <div class="admin-main fade-in-up">
        <header class="admin-header">
            <div>
                <a href="{{ url_for('admin_dashboard') }}"
                    style="text-decoration: none; color: var(--m3-primary); font-size: 14px; display: inline-block; margin-bottom: 16px;">←
                    بازگشت به داشبورد</a>
                <h1>ایجاد نظرسنجی جدید</h1>
                <p>تنظیمات و گزینه‌های نظرسنجی را در این بخش وارد کنید</p>
            </div>
        </header>

        <form action="{{ url_for('admin_create_poll') }}" method="POST" class="admin-card"
            style="margin: 0; max-width: 100%;">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <section class="form-section">
                <h3 class="title-large" style="margin-bottom: 24px;">اطلاعات پایه</h3>
                <div class="form-group">
                    <div class="text-field-wrapper">
                        <div class="md-filled-text-field">
                            <input type="text" id="title" name="title" required placeholder=" " maxlength="100">
                            <label for="title">عنوان نظرسنجی</label>
                        </div>
                        <div class="field-supporting-text">
                            <span class="supporting-text">عنوان کوتاه و گویا</span>
                            <span class="character-counter">0/100</span>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <div class="text-field-wrapper">
                        <div class="md-filled-text-field" style="height: auto;">
                            <textarea id="description" name="description" rows="4" placeholder=" " style="padding-top: 24px;" maxlength="500"></textarea>
                            <label for="description">توضیحات</label>
                        </div>
                        <div class="field-supporting-text">
                            <span class="supporting-text">جزئیات کامل نظرسنجی</span>
                            <span class="character-counter">0/500</span>
                        </div>
                    </div>
                </div>
            </section>

            <section class="form-section" style="margin-top: 48px;">
                <h3 class="title-large" style="margin-bottom: 24px;">زمان‌بندی (شمسی)</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px;">
                    <div class="form-group">
                        <label class="form-label">تاریخ شروع</label>
                        <div style="display: flex; gap: 8px;">
                            <div class="md-filled-text-field select-wrapper" style="width: 33%;">
                                <select name="start_day" required>
                                    <option value="" disabled selected></option>
                                    {% for d in range(1, 32) %}
                                    <option value="{{ d }}">{{ d }}</option>
                                    {% endfor %}
                                </select>
                                <label>روز</label>
                            </div>
                            <div class="md-filled-text-field select-wrapper" style="width: 33%;">
                                <select name="start_month" required>
                                    <option value="" disabled selected></option>
                                    <option value="1">فروردین</option>
                                    <option value="2">اردیبهشت</option>
                                    <option value="3">خرداد</option>
                                    <option value="4">تیر</option>
                                    <option value="5">مرداد</option>
                                    <option value="6">شهریور</option>
                                    <option value="7">مهر</option>
                                    <option value="8">آبان</option>
                                    <option value="9">آذر</option>
                                    <option value="10">دی</option>
                                    <option value="11">بهمن</option>
                                    <option value="12">اسفند</option>
                                </select>
                                <label>ماه</label>
                            </div>
                            <div class="md-filled-text-field select-wrapper" style="width: 33%;">
                                <select name="start_year" required>
                                    <option value="" disabled selected></option>
                                    {% for y in range(1402, 1412) %}
                                    <option value="{{ y }}" {% if y == 1403 %}selected{% endif %}>{{ y }}</option>
                                    {% endfor %}
                                </select>
                                <label>سال</label>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">تاریخ پایان</label>
                        <div style="display: flex; gap: 8px;">
                            <div class="md-filled-text-field select-wrapper" style="width: 33%;">
                                <select name="end_day" required>
                                    <option value="" disabled selected></option>
                                    {% for d in range(1, 32) %}
                                    <option value="{{ d }}">{{ d }}</option>
                                    {% endfor %}
                                </select>
                                <label>روز</label>
                            </div>
                            <div class="md-filled-text-field select-wrapper" style="width: 33%;">
                                <select name="end_month" required>
                                    <option value="" disabled selected></option>
                                    <option value="1">فروردین</option>
                                    <option value="2">اردیبهشت</option>
                                    <option value="3">خرداد</option>
                                    <option value="4">تیر</option>
                                    <option value="5">مرداد</option>
                                    <option value="6">شهریور</option>
                                    <option value="7">مهر</option>
                                    <option value="8">آبان</option>
                                    <option value="9">آذر</option>
                                    <option value="10">دی</option>
                                    <option value="11">بهمن</option>
                                    <option value="12">اسفند</option>
                                </select>
                                <label>ماه</label>
                            </div>
                            <div class="md-filled-text-field select-wrapper" style="width: 33%;">
                                <select name="end_year" required>
                                    <option value="" disabled selected></option>
                                    {% for y in range(1402, 1412) %}
                                    <option value="{{ y }}" {% if y == 1403 %}selected{% endif %}>{{ y }}</option>
                                    {% endfor %}
                                </select>
                                <label>سال</label>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <section class="form-section" style="margin-top: 48px;">
                <h3 class="title-large" style="margin-bottom: 24px;">گزینه‌های رأی‌گیری</h3>
                <div id="options-container">
                    <div class="form-group" style="margin-bottom: 12px;">
                        <div class="md-filled-text-field">
                            <input type="text" name="options[]" required placeholder=" ">
                            <label>گزینه ۱</label>
                        </div>
                    </div>
                    <div class="form-group" style="margin-bottom: 12px;">
                        <div class="md-filled-text-field">
                            <input type="text" name="options[]" required placeholder=" ">
                            <label>گزینه ۲</label>
                        </div>
                    </div>
                </div>
                <button type="button" class="btn btn-outlined" id="add-option" style="margin-top: 8px;">
                    ➕ افزودن گزینه دیگر
                </button>
            </section>

            <section class="form-section"
                style="margin-top: 48px; padding-top: 32px; border-top: 1px solid var(--m3-outline-variant); display: flex; justify-content: flex-end; gap: 16px;">
                <a href="{{ url_for('admin_dashboard') }}" class="btn btn-text">انصراف</a>
                <button type="submit" class="btn btn-filled">ایجاد و انتشار نظرسنجی</button>
            </section>
        </form>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.getElementById('add-option').addEventListener('click', function () {
        const container = document.getElementById('options-container');
        const count = container.children.length + 1;

        const formGroup = document.createElement('div');
        formGroup.className = 'form-group';
        formGroup.style.marginBottom = '12px';

        const filledField = document.createElement('div');
        filledField.className = 'md-filled-text-field';

        const input = document.createElement('input');
        input.type = 'text';
        input.name = 'options[]';
        input.required = true;
        input.placeholder = ' '; // Required for label floating

        const label = document.createElement('label');
        label.innerText = `گزینه ${count}`;

        filledField.appendChild(input);
        filledField.appendChild(label);
        formGroup.appendChild(filledField);

        container.appendChild(formGroup);
    });
</script>
{% endblock %}

{% extends "base.html" %}

{% block title %}ูพูู ูุฏุฑุช - ุงูุชุฎุงุจููุงฺฉ{% endblock %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/admin.css') }}">
{% endblock %}

{% block content %}
<div class="admin-layout">
    <!-- Sidebar -->
    <aside class="admin-sidebar">
        <div class="admin-logo">
            <span class="logo-icon">๐๏ธ</span>
            <span class="logo-text">ูุฏุฑุช</span>
        </div>
        <nav class="admin-nav">
            <a href="{{ url_for('admin_dashboard') }}" class="nav-link active">
                ๐ ุฏุงุดุจูุฑุฏ
            </a>
            <a href="{{ url_for('admin_create_poll') }}" class="nav-link">
                โ ุงุฌุงุฏ ูุธุฑุณูุฌ
            </a>
            <a href="{{ url_for('view_blockchain') }}" class="nav-link">
                โ๏ธ ุจูุงฺฉฺู
            </a>
            <a href="{{ url_for('public_results') }}" class="nav-link">
                ๐ ูุชุงุฌ ุนููู
            </a>
            <div style="margin-top: auto; padding-top: 32px;">
                <a href="{{ url_for('admin_logout') }}" class="nav-link" style="color: var(--m3-error);">
                    ๐ช ุฎุฑูุฌ
                </a>
            </div>
        </nav>
    </aside>

    <!-- Main Content -->
    <main class="admin-main">
        <header class="admin-header">
            <div>
                <h1>ูพูู ูุฏุฑุช</h1>
                <p>ุฎูุด ุขูุฏุฏุ ุดูุง ุจู ุนููุงู ูุฏุฑ ูุงุฑุฏ ุดุฏูโุงุฏ</p>
            </div>
            <div class="admin-actions">
                <a href="{{ url_for('admin_create_poll') }}" class="btn btn-filled">
                    โ ูุธุฑุณูุฌ ุฌุฏุฏ
                </a>
            </div>
        </header>

        <!-- Stats Overview -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-label">ฺฉู ูุธุฑุณูุฌโูุง</div>
                <div class="stat-value">{{ total_polls }}</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">ุขุฑุง ุซุจุช ุดุฏู</div>
                <div class="stat-value">{{ total_votes }}</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">ุฑุฃโุฏููุฏฺฏุงู ูุนุงู</div>
                <div class="stat-value">{{ total_voters }}</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">ูุถุนุช ุจูุงฺฉฺู</div>
                <div class="stat-value" style="font-size: 18px; color: var(--m3-success);">
                    {{ "โ ูุนุชุจุฑ" if blockchain_valid else "โ ูุงูุนุชุจุฑ" }}
                </div>
            </div>
        </div>

        <!-- Polls Management -->
        <section class="data-table-container">
            <div
                style="padding: 24px; border-bottom: 1px solid var(--m3-outline-variant); display: flex; justify-content: space-between; align-items: center;">
                <h3 class="title-large">ูุฏุฑุช ูุธุฑุณูุฌโูุง</h3>
                <div style="display: flex; gap: 12px;">
                    <select class="form-select" style="padding: 8px 12px; width: auto; font-size: 13px;">
                        <option>ููู ูุถุนุชโูุง</option>
                        <option>ูุนุงู</option>
                        <option>ูพุงุงู ุงูุชู</option>
                    </select>
                </div>
            </div>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>ุนููุงู ูุธุฑุณูุฌ</th>
                        <th>ูุถุนุช</th>
                        <th>ุชุนุฏุงุฏ ุขุฑุง</th>
                        <th>ุชุงุฑุฎ ูพุงุงู</th>
                        <th>ุนููุงุช</th>
                    </tr>
                </thead>
                <tbody>
                    {% if polls %}
                    {% for poll in polls %}
                    <tr>
                        <td style="font-weight: 600;">{{ poll.title }}</td>
                        <td>
                            <span
                                class="badge {% if poll.status == 'active' %}badge-active{% else %}badge-ended{% endif %}">
                                {{ "ูุนุงู" if poll.status == 'active' else "ูพุงุงู ุงูุชู" }}
                            </span>
                        </td>
                        <td>{{ poll.total_votes }} ุฑุฃ</td>
                        <td>{{ poll.end_time | jalali }}</td>
                        <td>
                            <div style="display: flex; gap: 8px;">
                                <a href="{{ url_for('view_results', poll_id=poll.id) }}" class="btn btn-text"
                                    style="padding: 4px 8px; font-size: 12px;">๐ ูุชุงุฌ</a>
                                <button class="btn btn-text" onclick="adminDashboard.confirmDeletePoll('{{ poll.id }}')"
                                    style="padding: 4px 8px; font-size: 12px; color: var(--m3-error);">๐๏ธ ุญุฐู</button>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                    {% else %}
                    <tr>
                        <td colspan="5" style="text-align: center; padding: 48px; color: var(--m3-on-surface-variant);">
                            ูฺ ูุธุฑุณูุฌโุง ุงูุช ูุดุฏ.
                        </td>
                    </tr>
                    {% endif %}
                </tbody>
            </table>
        </section>
    </main>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/admin.js') }}"></script>
{% endblock %}
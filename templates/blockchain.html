{% extends "base.html" %}

{% block title %}ูุดุงูุฏู ุจูุงฺฉโฺู - ุงูุชุฎุงุจููุงฺฉ{% endblock %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/blockchain.css') }}">
{% endblock %}

{% block content %}
<div class="blockchain-container fade-in-up">
    <div class="breadcrumb">
        <a href="{{ url_for('dashboard') }}">ุฏุงุดุจูุฑุฏ</a>
        <span class="separator">โ</span>
        <span class="current">ุจูุงฺฉโฺู</span>
    </div>

    <div class="blockchain-header">
        <div class="header-content">
            <h2>โ๏ธ ุฒูุฌุฑู ุจูุงฺฉโูุง ุฑุฃโฺฏุฑ</h2>
            <p class="subtitle">
                ููุงุด ุดูุงู ู ุบุฑูุงุจู ุชุบุฑ ุชูุงู ุขุฑุง ุซุจุช ุดุฏู ุฏุฑ ุณุณุชู
            </p>
        </div>
        <div class="blockchain-stats">
            <div class="stat-card">
                <div class="stat-icon">๐ฆ</div>
                <div class="stat-info">
                    <h3>{{ blockchain_length }}</h3>
                    <p>ุชุนุฏุงุฏ ุจูุงฺฉโูุง</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">๐ณ๏ธ</div>
                <div class="stat-info">
                    <h3>{{ total_votes }}</h3>
                    <p>ฺฉู ุขุฑุง ุซุจุช ุดุฏู</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">
                    {% if is_valid %}โ{% else %}โ๏ธ{% endif %}
                </div>
                <div class="stat-info">
                    <h3>{% if is_valid %}ูุนุชุจุฑ{% else %}ูุงูุนุชุจุฑ{% endif %}</h3>
                    <p>ูุถุนุช ุฒูุฌุฑู</p>
                </div>
            </div>
        </div>
    </div>

    {% if not is_valid %}
    <div class="alert alert-error">
        <div class="alert-icon">โ๏ธ</div>
        <div class="alert-content">
            <h4>ูุดุฏุงุฑ: ุจูุงฺฉโฺู ูุงูุนุชุจุฑ!</h4>
            <p>
                ฺฉ ุง ฺูุฏ ุจูุงฺฉ ุฏุฑ ุฒูุฌุฑู ุฏุณุชฺฉุงุฑ ุดุฏู ุงุณุช.
                ุงู ุงูุฑ ูโุชูุงูุฏ ูุดุงูู ุชูุงุด ุจุฑุง ุฏุณุชฺฉุงุฑ ุขุฑุง ุจุงุดุฏ.
            </p>
        </div>
    </div>
    {% endif %}

    <div class="blockchain-controls">
        <div class="search-box">
            <input type="text" id="searchBlock" placeholder="๐ ุฌุณุชุฌู ุจุฑ ุงุณุงุณ ุดูุงุฑู ุจูุงฺฉุ ูุด ุง ุชุงุฑุฎ..."
                class="search-input">
        </div>
        <div class="control-buttons">
            <button class="btn btn-outline" onclick="toggleAllBlocks()">
                <span class="icon">๐</span>
                ุจุงุฒ/ุจุณุชู ฺฉุฑุฏู ููู
            </button>
            <button class="btn btn-outline" onclick="verifyChain()">
                <span class="icon">๐</span>
                ุชุฃุฏ ุงุนุชุจุงุฑ
            </button>
            <button class="btn btn-success" onclick="window.print()">
                <span class="icon">๐จ๏ธ</span>
                ฺุงูพ
            </button>
        </div>
    </div>

    <div class="blockchain-chain" id="blockchainChain">
        {% for block in blocks %}
        <div class="block-item {% if not block.is_valid %}block-invalid{% endif %} fade-in-up stagger-{{ loop.index if loop.index <= 6 else 6 }}"
            data-block-index="{{ block.index }}">
            <div class="block-header" onclick="toggleBlock({{ block.index }})">
                <div class="block-number">
                    <span class="block-icon">
                        {% if block.index == 0 %}
                        ๐
                        {% else %}
                        ๐ฆ
                        {% endif %}
                    </span>
                    <span class="block-label">
                        {% if block.index == 0 %}
                        ุจูุงฺฉ ูพุงู (Genesis)
                        {% else %}
                        ุจูุงฺฉ #{{ block.index }}
                        {% endif %}
                    </span>
                </div>
                <div class="block-summary">
                    <span class="block-time">{{ block.timestamp }}</span>
                    <span class="block-status">
                        {% if block.is_valid %}
                        <span class="status-badge status-valid">โ</span>
                        {% else %}
                        <span class="status-badge status-invalid">โ</span>
                        {% endif %}
                    </span>
                    <span class="expand-icon">โผ</span>
                </div>
            </div>

            <div class="block-details" id="block-{{ block.index }}">
                <div class="detail-grid">
                    <div class="detail-item">
                        <label>ุดูุงุฑู ุจูุงฺฉ:</label>
                        <span class="value-mono">{{ block.index }}</span>
                    </div>
                    <div class="detail-item">
                        <label>ุฒูุงู ุงุฌุงุฏ:</label>
                        <span>{{ block.timestamp }}</span>
                    </div>
                    <div class="detail-item detail-full">
                        <label>ูุด ุจูุงฺฉ:</label>
                        <span class="value-mono hash-value" title="{{ block.hash }}">
                            {{ block.hash }}
                        </span>
                        <button class="copy-btn" onclick="copyToClipboard('{{ block.hash }}')">
                            ๐
                        </button>
                    </div>
                    <div class="detail-item detail-full">
                        <label>ูุด ุจูุงฺฉ ูุจู:</label>
                        <span class="value-mono hash-value" title="{{ block.previous_hash }}">
                            {{ block.previous_hash }}
                        </span>
                        <button class="copy-btn" onclick="copyToClipboard('{{ block.previous_hash }}')">
                            ๐
                        </button>
                    </div>
                </div>

                {% if block.index > 0 %}
                <div class="block-data">
                    <h4>๐ ุฏุงุฏูโูุง ุฑุฃ</h4>
                    <div class="data-grid">
                        <div class="data-item">
                            <label>ุดูุงุณู ูุธุฑุณูุฌ:</label>
                            <span>{{ block.data.poll_id }}</span>
                        </div>
                        <div class="data-item">
                            <label>ฺฏุฒูู ุงูุชุฎุงุจ:</label>
                            <span class="vote-choice">{{ block.data.choice }}</span>
                        </div>
                        <div class="data-item">
                            <label>ูุด ฺฉุฏ ูู ุฑุฃโุฏููุฏู:</label>
                            <span class="value-mono hash-short" title="{{ block.data.voter_hash }}">
                                {{ block.data.voter_hash[:16] }}...{{ block.data.voter_hash[-16:] }}
                            </span>
                            <button class="copy-btn" onclick="copyToClipboard('{{ block.data.voter_hash }}')">
                                ๐
                            </button>
                        </div>
                        <div class="data-item">
                            <label>ุฒูุงู ุฑุฃ:</label>
                            <span>{{ block.data.timestamp }}</span>
                        </div>
                    </div>
                </div>
                {% else %}
                <div class="genesis-info">
                    <p>
                        ุงู ุจูุงฺฉุ ุจูุงฺฉ ูพุงู (Genesis Block) ุฒูุฌุฑู ุงุณุช ู ุดุงูู ุฏุงุฏู ุฑุฃ ููโุจุงุดุฏ.
                        ุชูุงู ุจูุงฺฉโูุง ุจุนุฏ ุจู ุงู ุจูุงฺฉ ูุชุตู ูุณุชูุฏ.
                    </p>
                </div>
                {% endif %}

                <div class="block-link">
                    {% if block.index < blocks|length - 1 %} <div class="link-arrow">
                        โฌ๏ธ ูุชุตู ุจู ุจูุงฺฉ ุจุนุฏ
                </div>
                {% else %}
                <div class="link-end">
                    ๐ ุขุฎุฑู ุจูุงฺฉ ุฒูุฌุฑู
                </div>
                {% endif %}
            </div>
        </div>
    </div>
    {% endfor %}
</div>

<div class="blockchain-footer">
    <div class="info-card">
        <h3>๐ ุงููุช ุจูุงฺฉโฺู</h3>
        <p>
            ูุฑ ุจูุงฺฉ ุดุงูู ูุด ุจูุงฺฉ ูุจู ุงุณุช ฺฉู ุชุบุฑ ูุฑ ุจูุงฺฉ ุฑุง ุบุฑููฺฉู ูโุณุงุฒุฏ.
            ุญุช ฺฉูฺฺฉโุชุฑู ุชุบุฑ ุฏุฑ ุฏุงุฏูโูุงุ ูุด ุจูุงฺฉ ุฑุง ุชุบุฑ ุฏุงุฏู ู ุฒูุฌุฑู ูุงูุนุชุจุฑ ูโุดูุฏ.
        </p>
    </div>
    <div class="info-card">
        <h3>๐ต๏ธ ุญูุธ ุญุฑู ุฎุตูุต</h3>
        <p>
            ฺฉุฏ ูู ุฑุฃโุฏููุฏฺฏุงู ุจู ุตูุฑุช ูุดโุดุฏู (SHA-256) ุฐุฎุฑู ูโุดูุฏ.
            ุงู ุฑูุด ุงูฺฉุงู ุชุฃุฏ ุงุตุงูุช ุฑุฃ ุฑุง ุจุฏูู ุงูุดุง ููุช ูุงูุน ูุฑุงูู ูโฺฉูุฏ.
        </p>
    </div>
    <div class="info-card">
        <h3>โ ุดูุงูุช ฺฉุงูู</h3>
        <p>
            ูุฑ ุฑุฃ ุซุจุช ุดุฏู ุฏุฑ ุจูุงฺฉโฺู ุนูู ู ูุงุจู ุฏุณุชุฑุณ ุงุณุช.
            ูฺ ฺฉุณ ููโุชูุงูุฏ ฺฉ ุฑุฃ ุฑุง ุญุฐู ุง ูุฎู ฺฉูุฏ ู ุชูุงู ุซุจุชโูุง ุชุงุฑุฎ ูุญููุธ ูโูุงูุฏ.
        </p>
    </div>
</div>

<div class="action-buttons">
    <a href="{{ url_for('dashboard') }}" class="btn btn-outline">
        โ ุจุงุฒฺฏุดุช ุจู ุฏุงุดุจูุฑุฏ
    </a>
    <button class="btn btn-danger" onclick="simulateTampering()">
        <span class="icon">โ๏ธ</span>
        ุดุจูโุณุงุฒ ุฏุณุชฺฉุงุฑ (ุชุณุช)
    </button>
</div>
</div>

<div id="copyNotification" class="copy-notification">
    โ ฺฉูพ ุดุฏ!
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/blockchain.js') }}"></script>
{% endblock %}
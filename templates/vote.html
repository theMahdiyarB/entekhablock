{% extends "base.html" %}

{% block title %}ุฑุฃโุฏู - ุงูุชุฎุงุจููุงฺฉ{% endblock %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/vote.css') }}">
{% endblock %}

{% block content %}
<div class="vote-container">
    <!-- Breadcrumb -->
    <nav class="breadcrumb">
        <a href="{{ url_for('dashboard') }}">ุฏุงุดุจูุฑุฏ</a>
        <span>โ</span>
        <span>ุฑุฃโุฏู</span>
    </nav>

    <!-- Vote Header -->
    <header class="vote-header">
        <h1 class="vote-title">{{ poll.title }}</h1>
        {% if poll.description %}
        <p class="vote-description">{{ poll.description }}</p>
        {% endif %}

        <div class="vote-meta">
            <div class="meta-item">
                <span class="stat-icon">๐</span>
                <span>ูพุงุงู: {{ poll.end_time | jalali }}</span>
            </div>
            <div class="meta-item">
                <span class="stat-icon">๐ฅ</span>
                <span>{{ poll.votes.values()|sum }} ุฑุฃ ุซุจุช ุดุฏู</span>
            </div>
        </div>
    </header>

    <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
    {% for category, message in messages %}
    <div class="alert alert-{{ category }}">
        {{ message }}
    </div>
    {% endfor %}
    {% endif %}
    {% endwith %}

    <div class="vote-layout">
        <!-- Vote Form Area -->
        <div class="card-elevated">
            <!-- Instructions -->
            <div class="info-box">
                <h3>๐ ุฏุณุชูุฑุงูุนูู ุฑุฃโุฏู</h3>
                <ul>
                    <li>ฺฉ ุงุฒ ฺฏุฒููโูุง ุฒุฑ ุฑุง ุงูุชุฎุงุจ ฺฉูุฏ</li>
                    <li>ูพุณ ุงุฒ ุงูุชุฎุงุจุ ุฏฺฉูู "ุซุจุช ุฑุฃ" ุฑุง ุจุฒูุฏ</li>
                    <li>ุฑุฃ ุดูุง ุจู ุตูุฑุช ุฑูุฒูฺฏุงุฑ ุดุฏู ุฏุฑ ุจูุงฺฉโฺู ุซุจุช ูโุดูุฏ</li>
                    <li>ุงูฺฉุงู ุชุบุฑ ุฑุฃ ูพุณ ุงุฒ ุซุจุช ูุฌูุฏ ูุฏุงุฑุฏ</li>
                </ul>
            </div>

            <!-- Vote Form -->
            <form method="POST" action="{{ url_for('vote', poll_id=poll.poll_id) }}" id="vote-form">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                <div class="options-container">
                    {% for option in poll.options %}
                    <div class="option-card fade-in-up stagger-{{ loop.index if loop.index <= 4 else 4 }}">
                        <input type="radio" name="option" id="option-{{ loop.index }}" value="{{ option }}" required>
                        <label for="option-{{ loop.index }}" class="option-label">
                            <div class="radio-indicator">
                                <div class="radio-circle"></div>
                                <span>{{ option }}</span>
                            </div>
                        </label>
                    </div>
                    {% endfor %}
                </div>

                <!-- Submit Buttons -->
                <div class="control-buttons">
                    <button type="button" id="preview-btn" class="btn btn-outlined" disabled>
                        ๐๏ธ ูพุดโููุงุด
                    </button>
                    <button type="submit" id="submit-btn" class="btn btn-filled" disabled>
                        ๐ ุซุจุช ูุทุน ุฑุฃ
                    </button>
                </div>
            </form>
        </div>

        <!-- Sidebar -->
        <aside class="vote-sidebar fade-in-up stagger-2">
            <div class="card-elevated">
                <div class="stat-icon" style="font-size: 32px; margin-bottom: 12px;">๐</div>
                <h3 style="font-size: 16px; font-weight: 600; color: var(--m3-on-surface); margin-bottom: 12px;">
                    ุงููุช ุฑุฃ ุดูุง
                </h3>
                <p style="margin: 0; font-size: 13px; color: var(--m3-on-surface-variant); line-height: 1.6;">
                    ุฑุฃ ุดูุง ุจุง ุงูฺฏูุฑุชู SHA-256 ูุด ูโุดูุฏ ู ุจู ุตูุฑุช ูุงุดูุงุณ ุฏุฑ ุจูุงฺฉโฺู ุซุจุช ูโฺฏุฑุฏุฏ.
                </p>
            </div>

            <div style="margin-top: 24px; text-align: center;">
                <a href="{{ url_for('dashboard') }}" class="btn btn-text">
                    โ ุจุงุฒฺฏุดุช ุจู ุฏุงุดุจูุฑุฏ
                </a>
            </div>
        </aside>
    </div>
</div>

<!-- Preview Modal -->
<div id="preview-modal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>ูพุดโููุงุด ุฑุฃ ุดูุง</h3>
            <button type="button" id="close-modal">โ</button>
        </div>

        <div class="modal-body">
            <div
                style="background-color: var(--m3-surface-container-low); padding: 16px; border-radius: var(--m3-shape-md); margin-bottom: 16px;">
                <div style="margin-bottom: 12px;">
                    <span style="font-size: 12px; color: var(--m3-on-surface-variant);">ูุธุฑุณูุฌ</span>
                    <p style="margin: 4px 0 0 0; font-size: 15px; color: var(--m3-on-surface);">{{ poll.title }}</p>
                </div>
                <div style="border-top: 1px solid var(--m3-outline-variant); padding-top: 12px;">
                    <span style="font-size: 12px; color: var(--m3-on-surface-variant);">ุงูุชุฎุงุจ ุดูุง</span>
                    <p style="margin: 4px 0 0 0; font-size: 15px; font-weight: 600; color: var(--m3-primary);"
                        id="selected-option"></p>
                </div>
            </div>

            <div class="alert alert-error">
                <span class="alert-icon">โ๏ธ</span>
                <p>ุชูุฌู: ูพุณ ุงุฒ ุซุจุช ูุทุนุ ุงูฺฉุงู ุชุบุฑ ุฑุฃ ูุฌูุฏ ูุฏุงุฑุฏ!</p>
            </div>
        </div>

        <div class="modal-footer">
            <button type="button" class="btn btn-outlined" id="edit-btn">ูุฑุงุด</button>
            <button type="button" class="btn btn-filled" id="confirm-btn">ุชุฃุฏ ู ุซุจุช</button>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>window.POLL_ID = "{{ poll.poll_id }}";</script>
<script src="{{ url_for('static', filename='js/vote.js') }}"></script>
{% endblock %}